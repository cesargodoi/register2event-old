{{ extend 'layout.html' }}

{{ block header }}
  {{
    if bedroom.gender=='M':
      gender_txt = 'Masculino'
    elif bedroom.gender=='F':
      gender_txt = 'Feminino'
    else:
      gender_txt = 'Mixto'
    pass
  }}
  <div class="row">
    <div class="col-sm-12">
      <h3>{{= building[1] }}&nbsp;&nbsp;{{= bedroom.bedroom }}
        <small class="text-secondary">
          &nbsp;&nbsp; {{= gender_txt }}
        </small>
      </h3>
    </div>
  </div>
{{end}}

{{block content}}
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="{{=URL('events', 'show', vars={'evenid': event.id, 'admin_view':'T'})}}">{{=T('event')}}</a>
    </li>
    <li class="breadcrumb-item">
      <a href="{{=URL('accommodations', 'buildings_on_event', vars={'evenid': event.id})}}">{{=T('buildings')}}</a>
    </li>
    <li class="breadcrumb-item">
      <a href="{{=URL('accommodations', 'building_on_event', vars={'builid':building[0], 'evenid': event.id})}}">{{=T('building')}}</a>
    </li>
    <li class="breadcrumb-item">
      <a href="{{=URL('accommodations', 'bedrooms_by_gender_on_event', vars={'builid':building[0],'gender':bedroom.gender, 'evenid':event.id})}}">{{=T('bedrooms')}}</a>
    </li>
    <li class="breadcrumb-item active">{{= bedroom.bedroom }}</li>
  </ol>

  <div class="row">
    {{if bedroom.tops:}}
    <div class="col-sm-7">
      <div class="row">
        <div class="col-sm-6">
          <h4>Camas de baixo</h4>
          <table class="table table-striped">
            {{ for i in bedroom.beds: }}
              {{ if i > 0: }}
              <tr>
                <td width="30px">
                  <img src="{{= URL('static', 'images/bedicons', args='bed_BN.png') }}"><br>
                </td>
                <td>
                  {{= guests[i]['name'] }}
                  <button 
                    type="button"
                    class="btn btn-outline-danger btn-sm float-end"
                    onclick="removeFromBedroom({{= i }})"
                  >
                    <i class="bi bi-trash"></i>
                    Remove
                  </button>
                  {{
                    label = 'success'
                    if guests[i]['age']>35 and guests[i]['age']<60:
                      label = 'warning'
                    elif guests[i]['age']>=60:
                      label = 'danger'
                    pass
                  }}
                  <span class="badge bg-{{=label}} float-end me-2">{{= guests[i]['age'] }}</span>
                  {{ if guests[i]['no_stairs']: }}
                    <img class="float-end me-2" src="{{= URL('static', 'images/bedicons', args='NoStairs.png') }}" width="22px">
                  {{ pass }}
                  {{ if guests[i]['no_top_bunk']: }}
                    <img class="float-end me-2" src="{{= URL('static', 'images/bedicons', args='NoTopBunks.png') }}" width="22px">
                  {{ pass }}
                </td>
              </tr>
              {{else:}}
              <tr>
                <td width="30px">
                  <img src="{{= URL('static', 'images/bedicons', args='bed_BY.png') }}" draggable="true">
                </td>
                <td>{{= T('ready to use') }}</td>
              </tr>
              {{pass}}
            {{pass}}
          </table>
        </div>

        <div class="col-sm-6">
          <h4>Camas de cima</h4>
          <table class="table table-striped">
            {{ for i in bedroom.tops: }}
              {{ if i > 0: }}
              <tr>
                <td width="30px">
                  <img src="{{= URL('static', 'images/bedicons', args='bed_TN.png') }}" draggable="true">
                </td>
                <td>
                  {{= guests[i]['name'] }}
                  <button 
                    type="button"
                    class="btn btn-outline-danger btn-sm float-end"
                    onclick="removeFromBedroom({{= i }})"
                  >
                    <i class="bi bi-trash"></i>
                    Remove
                  </button>
                  {{
                    label = 'success'
                    if guests[i]['age']>35 and guests[i]['age']<60:
                      label = 'warning'
                    elif guests[i]['age']>=60:
                      label = 'danger'
                    pass
                  }}
                  <span class="badge bg-{{= label }} float-end me-2">{{= guests[i]['age'] }}</span>
                  {{if guests[i]['no_stairs']:}}
                    <img class="float-end me-2" src="{{= URL('static', 'images/bedicons', args='NoStairs.png') }}" width="22px">
                  {{pass}}
                  {{if guests[i]['no_top_bunk']:}}
                    <img class="float-end me-2" src="{{= URL('static', 'images/bedicons', args='NoTopBunks.png') }}" width="22px">
                  {{pass}}
                </td>
              </tr>
              {{else:}}
              <tr>
                <td width="30px">
                  <img src="{{= URL('static', 'images/bedicons', args='bed_TY.png') }}" draggable="true">
                </td>
                <td>{{=T('ready to use')}}</td>
              </tr>
              {{pass}}
            {{pass}}
          </table>
        </div>
      </div>
    {{else:}}
    <div class="col-sm-7">
      <div class="row">
        <div class="col-sm-6">
          <table class="table table-striped">
            <caption>Camas</caption>
            {{ for i in bedroom.beds: }}
              {{ if i > 0: }}
              <tr>
                <td width="30px">
                  <img src="{{= URL('static', 'images/bedicons', args='bed_N.png') }}" draggable="true">
                </td>
                <td>
                  {{= guests[i]['name'] }}
                  <button 
                    type="button"
                    class="btn btn-outline-danger btn-sm float-end"
                    onclick="removeFromBedroom({{= i }})"
                  >
                    <i class="bi bi-trash"></i>
                    Remove
                  </button>
                  {{
                    label = 'success'
                    if guests[i]['age']>35 and guests[i]['age']<60:
                      label = 'warning'
                    elif guests[i]['age']>=60:
                      label = 'danger'
                    pass
                  }}
                  <span class="badge bg-{{= label }} float-end me-2">{{= guests[i]['age'] }}</span>
                  {{if guests[i]['no_stairs']:}}
                    <img class="float-end me-2" src="{{= URL('static', 'images/bedicons', args='NoStairs.png') }}" width="22px">
                  {{pass}}
                  {{if guests[i]['no_top_bunk']:}}
                    <img class="float-end me-2" src="{{= URL('static', 'images/bedicons', args='NoTopBunks.png') }}" width="22px">
                  {{pass}}
                </td>
              </tr>
              {{ else: }}
              <tr>
                <td width="30px">
                  <img src="{{= URL('static', 'images/bedicons', args='bed_Y.png') }}" draggable="true">
                </td>
                <td>{{= T('ready to use') }}</td>
              </tr>
              {{pass}}
            {{pass}}
          </table>
        </div>
      </div>
    </div>
    {{pass}}
  </div>

  {{ if session.mapp.unallocateds: }}
    {{ include 'accommodations/guests_unallocated.html' }}
  {{ pass }}

  <div id="confirm" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>

  <style type="text/css">
    div .table {
      font-family: monospace;
      font-size: 10pt;
    }
  </style>
{{ end }}

{{ block scripts }}
<script type="text/javascript">
  function addToBedroom(gid, rid){
    var bd = {{=bedroom.id}};
    var gn = '{{=bedroom.gender}}';
    var ev = {{=event.id}};
    if (confirm("{{=T('Are you sure')}}?")) {
      ajax(`{{=URL('accommodations', 'add_to_bedroom')}}?evenid=${ev}&bedroomid=${bd}&guesid=${gid}&regid=${rid}&gender=${gn}`, [], ':eval');
    }
  }

  function removeFromBedroom(gs){
    var bd = {{=bedroom.id}};
    var ev = {{=event.id}};
    if (confirm("{{=T('Are you sure')}}?")) {
      ajax(`{{=URL('accommodations', 'remove_from_bedroom')}}?evenid=${ev}&bedroomid=${bd}&guesid=${gs}`, [], ':eval');
    }
  }
</script>
{{ end }}
